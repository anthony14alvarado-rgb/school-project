<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus OS - Limbo True Sequence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #c3a6ff; --bg: #010101; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: #000; color: white; height: 100vh; overflow: hidden; }

        /* --- LIMBO OVERLAY --- */
        #limbo-overlay {
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #status-text { font-family: 'Orbitron'; font-size: 28px; color: #1a1a1a; margin-bottom: 80px; letter-spacing: 20px; transition: 0.5s; }
        
        #game-container { position: relative; width: 400px; height: 300px; }

        .block-key {
            position: absolute; width: 70px; height: 70px;
            background: #080808; border: 3px solid #222; border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                                    top 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                                    border-color 0.4s, color 0.4s, box-shadow 0.4s;
        }

        .inner-square { width: 20px; height: 20px; border: 4px solid currentColor; transform: rotate(45deg); }

        /* --- OS INTERFACE --- */
        #nexus-ui { opacity: 0; transition: opacity 1.5s; height: 100%; display: flex; pointer-events: none; }
        #nexus-ui.active { opacity: 1; pointer-events: all; }
        .sidebar { width: 100px; background: rgba(0,0,0,0.9); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 50px; }
        .sidebar div { color: #333; font-weight: 900; font-size: 10px; text-transform: uppercase; cursor: pointer; letter-spacing: 2px; }
        .sidebar .active-tab { color: var(--accent); text-shadow: 0 0 10px var(--accent); }
        .content { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: radial-gradient(circle at center, #111 0%, #000 100%); }
    </style>
</head>
<body>

    <div id="limbo-overlay">
        <div id="status-text">FOCUS</div>
        <div id="game-container"></div>
    </div>

    <div id="nexus-ui">
        <div class="sidebar">
            <div class="active-tab">Home</div>
            <div>Games</div>
            <div>Settings</div>
        </div>
        <div class="content">
            <h1 style="font-family:'Orbitron'; font-size: 70px; letter-spacing: 25px; margin-bottom: 20px;">NEXUS</h1>
            <div style="width: 300px; height: 1px; background: var(--accent); opacity: 0.3;"></div>
        </div>
    </div>

    <script>
        const container = document.getElementById('game-container');
        const status = document.getElementById('status-text');
        let keys = [];
        let targetIdx = 0;
        let canPick = false;

        const grid = [
            {x: 0, y: 0}, {x: 100, y: 0}, {x: 200, y: 0}, {x: 300, y: 0},
            {x: 0, y: 120}, {x: 100, y: 120}, {x: 200, y: 120}, {x: 300, y: 120}
        ];

        function startLimbo() {
            container.innerHTML = '';
            keys = [];
            canPick = false;
            targetIdx = Math.floor(Math.random() * 8);
            status.innerText = "FOCUS";
            status.style.color = "#1a1a1a";

            for(let i=0; i<8; i++) {
                const k = document.createElement('div');
                k.className = 'block-key';
                k.innerHTML = '<div class="inner-square"></div>';
                k.style.left = grid[i].x + 'px';
                k.style.top = grid[i].y + 'px';
                k.style.color = "#444";
                k.dataset.spot = i;
                k.onclick = () => handleChoice(i);
                container.appendChild(k);
                keys.push(k);
            }
            setTimeout(revealTarget, 1000);
        }

        function revealTarget() {
            keys[targetIdx].style.color = "#55ff55";
            keys[targetIdx].style.borderColor = "#55ff55";
            keys[targetIdx].style.boxShadow = "0 0 20px #55ff55";

            setTimeout(() => {
                keys.forEach(k => {
                    k.style.color = "#500"; // Phase 1: Dark Red
                    k.style.borderColor = "#200";
                    k.style.boxShadow = "none";
                });
                runGridSwaps();
            }, 1200);
        }

        // --- PHASE 1: KEY TO KEY SWITCHING ---
        function runGridSwaps() {
            let count = 0;
            const interval = setInterval(() => {
                let a = Math.floor(Math.random() * 8);
                let b = Math.floor(Math.random() * 8);
                while(a === b) b = Math.floor(Math.random() * 8);

                let spotA = keys[a].dataset.spot;
                let spotB = keys[b].dataset.spot;

                keys[a].style.left = grid[spotB].x + 'px';
                keys[a].style.top = grid[spotB].y + 'px';
                keys[b].style.left = grid[spotA].x + 'px';
                keys[b].style.top = grid[spotA].y + 'px';

                keys[a].dataset.spot = spotB;
                keys[b].dataset.spot = spotA;

                count++;
                if(count > 15) {
                    clearInterval(interval);
                    setTimeout(runColorCircle, 500);
                }
            }, 300);
        }

        // --- PHASE 2: COLOR CIRCLE ANIMATION ---
        function runColorCircle() {
            const colors = ['#ff4444', '#44ff44', '#4444ff', '#ffff44', '#ff44ff', '#44ffff', '#ff8800', '#ffffff'];
            keys.forEach((k, i) => {
                k.style.color = colors[i];
                k.style.borderColor = colors[i];
                k.style.boxShadow = `0 0 15px ${colors[i]}`;
            });

            let angle = 0;
            const orbit = setInterval(() => {
                angle += 0.12;
                keys.forEach((k, i) => {
                    const offset = (i * Math.PI * 2) / 8;
                    const r = 140; 
                    k.style.left = (165 + Math.cos(angle + offset) * r) + 'px';
                    k.style.top = (115 + Math.sin(angle + offset) * r) + 'px';
                });

                if(angle > 12) { // Spins for a few seconds
                    clearInterval(orbit);
                    runSpreadFinish();
                }
            }, 16);
        }

        // --- PHASE 3: SPREAD OUT AND PICK ---
        function runSpreadFinish() {
            const finalGrid = [
                {x: -50, y: -50}, {x: 110, y: -80}, {x: 270, y: -50}, {x: 430, y: 0},
                {x: -50, y: 200}, {x: 110, y: 230}, {x: 270, y: 200}, {x: 430, y: 150}
            ];

            keys.forEach((k, i) => {
                k.style.left = finalGrid[i].x + 'px';
                k.style.top = finalGrid[i].y + 'px';
            });

            setTimeout(() => {
                status.innerText = "CHOOSE";
                status.style.color = "#fff";
                status.style.textShadow = "0 0 20px white";
                canPick = true;
            }, 600);
        }

        function handleChoice(i) {
            if(!canPick) return;
            if(i === targetIdx) {
                document.getElementById('limbo-overlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('limbo-overlay').style.display = 'none';
                    document.getElementById('nexus-ui').classList.add('active');
                }, 500);
            } else {
                startLimbo(); // Reset on fail
            }
        }

        window.onload = startLimbo;
    </script>
</body>
</html>
